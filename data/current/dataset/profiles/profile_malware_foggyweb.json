[
  {
    "id": "malware--72911fe3-f085-40f7-b4f2-f25a4221fe44",
    "name": "foggyweb",
    "aliases": "none",
    "platforms": "windows",
    "malware_id": "S0661",
    "is_revoked": false,
    "profile": {
      "tactics": {
        "count": 10,
        "items": [
          "collection",
          "command-and-control",
          "credential-access",
          "defense-evasion",
          "discovery",
          "execution",
          "exfiltration",
          "lateral-movement",
          "persistence",
          "privilege-escalation"
        ]
      },
      "techniques": {
        "count": 21,
        "items": [
          "T1005",
          "T1027",
          "T1027.004",
          "T1036",
          "T1036.005",
          "T1040",
          "T1041",
          "T1057",
          "T1071.001",
          "T1083",
          "T1105",
          "T1106",
          "T1129",
          "T1140",
          "T1550",
          "T1552.004",
          "T1560.002",
          "T1560.003",
          "T1573.001",
          "T1574.001",
          "T1620"
        ]
      },
      "adversaries": {
        "count": 1,
        "items": [
          "apt29"
        ]
      },
      "procedures": [
        "T1005::[FoggyWeb] can retrieve configuration data from a compromised AD FS server.",
        "T1027.004::[FoggyWeb] can compile and execute source code sent to the compromised AD FS server via a specific HTTP POST.",
        "T1027::[FoggyWeb] has been XOR-encoded.",
        "T1036.005::[FoggyWeb] can be disguised as a Visual Studio file such as `Windows.Data.TimeZones.zh-PH.pri` to evade detection. Also, [FoggyWeb]'s loader can mimic a genuine `dll` file that carries out the same import functions as the legitimate Windows `version.dll` file.",
        "T1036::[FoggyWeb] can masquerade the output of C2 commands as a fake, but legitimately formatted WebP file.",
        "T1040::[FoggyWeb] can configure custom listeners to passively monitor all incoming HTTP GET and POST requests sent to the AD FS server from the intranet/internet and intercept HTTP requests that match the custom URI patterns defined by the actor.",
        "T1041::[FoggyWeb] can remotely exfiltrate sensitive information from a compromised AD FS server.",
        "T1057::[FoggyWeb]'s loader can enumerate all Common Language Runtimes (CLRs) and running Application Domains in the compromised AD FS server's Microsoft.IdentityServer.ServiceHost.exe process.",
        "T1071.001::[FoggyWeb] has the ability to communicate with C2 servers over HTTP GET/POST requests.",
        "T1083::[FoggyWeb]'s loader can check for the [FoggyWeb] backdoor .pri file on a compromised AD FS server.",
        "T1105::[FoggyWeb] can receive additional malicious components from an actor controlled C2 server and execute them on a compromised AD FS server.",
        "T1106::[FoggyWeb]'s loader can use API functions to load the [FoggyWeb] backdoor into the same Application Domain within which the legitimate AD FS managed code is executed.",
        "T1129::[FoggyWeb]'s loader can call the load() function to load the [FoggyWeb] dll into an Application Domain on a compromised AD FS server.",
        "T1140::[FoggyWeb] can be decrypted in memory using a Lightweight Encryption Algorithm (LEA)-128 key and decoded using a XOR key.",
        "T1550::[FoggyWeb] can allow abuse of a compromised AD FS server's SAML token.",
        "T1552.004::[FoggyWeb] can retrieve token signing certificates and token decryption certificates from a compromised AD FS server.",
        "T1560.002::[FoggyWeb] can invoke the `Common.Compress` method to compress data with the C# GZipStream compression class.",
        "T1560.003::[FoggyWeb] can use a dynamic XOR key and a custom XOR methodology to encode data before exfiltration. Also, [FoggyWeb] can encode C2 command output within a legitimate WebP file.",
        "T1573.001::[FoggyWeb] has used a dynamic XOR key and custom XOR methodology for C2 communications.",
        "T1574.001::[FoggyWeb]'s loader has used DLL Search Order Hijacking to load malicious code instead of the legitimate `version.dll` during the `Microsoft.IdentityServer.ServiceHost.exe` execution process.",
        "T1620::[FoggyWeb]'s loader has reflectively loaded .NET-based assembly/payloads into memory."
      ]
    },
    "description": "[FoggyWeb](https://attack.mitre.org/software/S0661) is a passive and highly-targeted backdoor capable of remotely exfiltrating sensitive information from a compromised Active Directory Federated Services (AD FS) server. It has been used by [APT29](https://attack.mitre.org/groups/G0016) since at least early April 2021.(Citation: MSTIC FoggyWeb September 2021)"
  }
]
